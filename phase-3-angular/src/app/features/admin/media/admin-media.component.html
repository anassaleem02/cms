<div class="media-library">
  <app-breadcrumb [items]="[{label:'Admin',link:'/admin'},{label:'Media Library'}]"></app-breadcrumb>
  <app-confirm-dialog
    [visible]="deleteDialogVisible"
    title="Delete File"
    [message]="'Delete ' + (fileToDelete?.originalFileName || '') + '? This cannot be undone.'"
    confirmText="Delete"
    (confirmed)="onDeleteConfirmed()"
    (cancelled)="deleteDialogVisible = false">
  </app-confirm-dialog>

  <div class="page-header">
    <h1>Media Library</h1>
    <span class="file-count">{{filteredFiles.length}} files</span>
  </div>

  <!-- Upload Zone -->
  <div class="upload-zone" [class.drag-over]="dragOver"
       (dragover)="onDragOver($event)" (dragleave)="onDragLeave()" (drop)="onDrop($event)">
    <input type="file" id="fileInput" multiple (change)="onFileSelect($event)" style="display:none">
    <div class="upload-content">
      <div class="upload-icon" *ngIf="!uploading">
        <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
      </div>
      <div class="upload-spinner spinner" *ngIf="uploading"></div>
      <p *ngIf="!uploading">Drag & drop files here, or <label for="fileInput" class="upload-link">browse</label></p>
      <p *ngIf="uploading" class="uploading-text">Uploading...</p>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-bar">
    <div class="search-box">
      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      <input type="text" placeholder="Search files..." [(ngModel)]="searchQuery" (input)="onSearchChange()">
    </div>
    <div class="type-filters">
      <button *ngFor="let type of fileTypes" class="filter-btn" [class.active]="filterType === type.value" (click)="filterType = type.value; onFilterChange()">{{type.label}}</button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="files-grid">
    <div *ngFor="let i of [1,2,3,4,5,6,7,8]" class="file-skeleton skeleton"></div>
  </div>

  <!-- Files Grid -->
  <div *ngIf="!loading && filteredFiles.length" class="files-grid">
    <div *ngFor="let file of filteredFiles" class="file-card">
      <div class="file-preview">
        <img *ngIf="isImage(file)" [src]="'http://localhost:5000' + file.url" [alt]="file.originalFileName" loading="lazy">
        <div *ngIf="!isImage(file)" class="file-icon">
          <svg width="32" height="32" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        </div>
      </div>
      <div class="file-info">
        <p class="file-name" [title]="file.originalFileName">{{file.originalFileName}}</p>
        <p class="file-meta">{{formatSize(file.fileSize)}} ¬∑ {{file.contentType.split('/')[1]}}</p>
        <p class="file-tags" *ngIf="file.tags">üè∑Ô∏è {{file.tags}}</p>
      </div>
      <div class="file-actions">
        <button class="action-btn" (click)="copyUrl(file.url)" title="Copy URL">
          <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
        </button>
        <button class="action-btn danger" (click)="confirmDelete(file)" title="Delete">
          <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !filteredFiles.length" class="empty-state">
    <p>No files found. Upload some files to get started.</p>
  </div>
</div>
