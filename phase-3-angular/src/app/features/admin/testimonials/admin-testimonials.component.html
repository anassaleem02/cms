<div class="page-header">
  <h1>Testimonials</h1>
  <button class="btn btn-primary" (click)="openCreate()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    Add Testimonial
  </button>
</div>

<div class="skeleton" style="height:300px;border-radius:var(--radius-xl);" *ngIf="loading"></div>

<div class="table-wrapper" *ngIf="!loading">
  <table>
    <thead><tr><th>Customer</th><th>Rating</th><th>Review</th><th>Active</th><th>Actions</th></tr></thead>
    <tbody>
      <tr *ngFor="let item of items">
        <td>
          <div style="display:flex;align-items:center;gap:var(--space-3);">
            <img [src]="item.customerImageUrl" [alt]="item.customerName" style="width:36px;height:36px;border-radius:50%;object-fit:cover;" onerror="this.src='https://ui-avatars.com/api/?name=Customer&background=10B981&color=fff'" />
            <div>
              <div style="font-weight:600;font-size:var(--text-sm);">{{ item.customerName }}</div>
              <div style="font-size:var(--text-xs);color:var(--text-secondary);">{{ item.customerTitle }}</div>
            </div>
          </div>
        </td>
        <td>
          <div style="display:flex;gap:2px;">
            <svg *ngFor="let s of getStars(item.rating)" width="14" height="14" viewBox="0 0 24 24" fill="#F59E0B"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          </div>
        </td>
        <td style="max-width:250px;font-size:var(--text-xs);color:var(--text-secondary);">{{ item.review | slice:0:80 }}...</td>
        <td><span class="badge" [class.badge-primary]="item.isActive">{{ item.isActive ? 'Yes' : 'No' }}</span></td>
        <td>
          <div style="display:flex;gap:var(--space-2);">
            <button class="action-btn edit-btn" (click)="openEdit(item)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
            <button class="action-btn delete-btn" (click)="confirmDelete(item.id)"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg></button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="modal-overlay" *ngIf="showForm" (click)="showForm = false">
  <div class="modal glass-card" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editingId ? 'Edit' : 'Add' }} Testimonial</h2>
      <button class="modal-close" (click)="showForm = false"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-row"><div class="form-group"><label>Customer Name *</label><input type="text" formControlName="customerName" /></div>
      <div class="form-group"><label>Customer Title *</label><input type="text" formControlName="customerTitle" /></div></div>
      <div class="form-group"><label>Photo URL</label><input type="text" formControlName="customerImageUrl" placeholder="https://..." /></div>
      <div class="form-group"><label>Review *</label><textarea formControlName="review" rows="4"></textarea></div>
      <div class="form-row">
        <div class="form-group"><label>Rating (1-5)</label><input type="number" formControlName="rating" min="1" max="5" /></div>
        <div class="form-group"><label>Display Order</label><input type="number" formControlName="displayOrder" /></div>
        <div class="form-group checkbox-group"><label><input type="checkbox" formControlName="isActive" /> Active</label></div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-outline" (click)="showForm = false">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="isSaving">{{ isSaving ? 'Saving...' : 'Save' }}</button>
      </div>
    </form>
  </div>
</div>

<div class="modal-overlay" *ngIf="deleteConfirmId" (click)="deleteConfirmId = null">
  <div class="modal modal-sm glass-card" (click)="$event.stopPropagation()">
    <h3>Delete Testimonial?</h3><p>This cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn btn-outline" (click)="deleteConfirmId = null">Cancel</button>
      <button class="btn" style="background:var(--color-error);color:white;" (click)="doDelete()">Delete</button>
    </div>
  </div>
</div>
